{% extends 'parent/base.html' %}

{% load static jformat report_tags %}

{% block title %}{{ report.title }} | مسجد رضویه{% endblock %}

{% block seo %}
    <meta name="description"
          content="{{ report.description|striptags|truncatechars:160 }}">
    <meta name="keywords"
          content="{% for tag in report.tags.all %}{{ tag.name }}, {% endfor %}">
    <link rel="canonical" href="{{ request.build_absolute_uri }}">
    <meta property="og:title" content="{{ report.title }}">
    <meta property="og:description" content="{{ report.description|striptags|truncatechars:160 }}">
    <meta property="og:type" content="article">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:site_name" content="مسجد رضویه">
    {% if report.images.first %}
        <meta property="og:image" content="{{ report.images.first.image.url }}">
    {% endif %}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ report.title }}">
    <meta name="twitter:description" content="{{ report.description|striptags|truncatechars:150 }}">
    {% if report.images.first %}
        <meta name="twitter:image" content="{{ report.images.first.image.url }}">
    {% endif %}
    <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "Article",
          "headline": "{{ report.title }}",
  "description": "{{ report.description|striptags|truncatechars:160 }}",
  "datePublished": "{{ report.date|date:'Y-m-d' }}",
  "dateModified": "{{ report.created|date:'Y-m-d' }}",
  "author": {
    "@type": "Organization",
    "name": "مسجد رضویه"
  },
        {% if report.images.first %}
            "image": "{{ report.images.first.image.url }}",
        {% endif %}
        "publisher": {
          "@type": "Organization",
          "name": "مسجد رضویه",
          "logo": {
            "@type": "ImageObject",
            "url": "https://razaviyehinfo.ir/static/img/logo.png"
          }
        }
      }
    </script>
    <script type="application/ld+json">
        {
         "@context": "https://schema.org",
         "@type": "BreadcrumbList",
         "itemListElement": [
          {
           "@type": "ListItem",
           "position": 1,
           "name": "خانه",
           "item": "https://razaviyehinfo.ir/"
          },
          {
           "@type": "ListItem",
           "position": 2,
           "name": "گزارشات",
           "item": "https://razaviyehinfo.ir/report/reports/"
          }
        {% if report.categories.first %}
            ,{
             "@type": "ListItem",
             "position": 3,
             "name": "{{ report.categories.first.name }}",
   "item": "{{ report.categories.first.get_absolute_url }}"
  }
        {% endif %}
        ]
       }
    </script>
{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'report/css/report/report_detail.css' %}">
    <link rel="stylesheet" href="{% static 'report/css/report/comment_list.css' %}">
{% endblock %}

{% block body %}
    <div class="report-detail-container container">
        <div class="report-meta card">
            <h1 class="report-title">{{ report.title }}</h1>

            <div class="report-stats">
                <!-- دکمه لایک -->
                <div class="stat-item like-wrapper">
                    <button class="like-btn" data-id="{{ report.id }}">
                        <img src="{% if liked %}{% static 'report/icons/heart_full.svg' %}{% else %}
                                {% static 'report/icons/heart_empty.svg' %}{% endif %}" alt="like" class="like-icon">
                    </button>
                    <span class="like-count">{{ likes_count }}</span>
                </div>

                <div class="stat-item">
                    <img src="{% static 'report/icons/view.svg' %}" alt="views">
                    <span>{{ report.views }}</span>
                </div>

                <div class="stat-item">
                    <img src="{% static 'report/icons/comment.svg' %}" alt="comments">
                    <span>{{ active_comments_count }}</span>
                </div>

                <div class="stat-item">
                    <img src="{% static 'report/icons/date.svg' %}" alt="date">
                    <span>{{ report.created|jformat:"%Y/%m/%d" }}</span>
                </div>
            </div>
        </div>

        {% if report.images.all %}
            <section class="report-gallery">
                {% for image in report.images.all %}
                    <div class="gallery-item">
                        <img src="{{ image.image.url }}" alt="{{ report.title }}">
                    </div>
                {% endfor %}
            </section>
        {% endif %}

        <article class="report-content card">
            {{ report.description|linebreaks }}
        </article>

        {% if report.tags.all %}
            <div class="report-tags">
                <h4>برچسب‌ها:</h4>
                <ul class="tag-list">
                    {% for tag in report.tags.all %}
                        <li>
                            <a href="{{ tag.get_absolute_url }}" class="tag-item">#{{ tag.name }}</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        <section class="comments-section">
            <h2>نظرات</h2>
            <a href="{% url 'report:report_comment' report.id report.slug %}" class="btn btn-primary">ارسال نظر</a>
            {% latest_comments 3 %}
            {% if active_comments_count > 3 %}
                <div class="more-comments">
                    <a href="{% url 'report:report_comment_list' report.id report.slug %}">مشاهده تمام کامنت‌ها</a>
                </div>
            {% endif %}
        </section>
    </div>

    <div id="lightbox" class="lightbox">
        <span class="close">&times;</span>
        <span class="prev">&#10094;</span>
        <img class="lightbox-img" src="" alt="">
        <span class="next">&#10095;</span>
    </div>
{% endblock %}

{% block scripts %}
    <script src="{% static 'report/js/lightbox.js' %}"></script>
    <script src="{% static 'report/js/comment_react.js' %}"></script>
    <script src="{% static 'report/js/report_likes.js' %}"></script>
{% endblock %}