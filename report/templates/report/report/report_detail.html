{% extends 'parent/base.html' %}
{% load static %}
{% load jformat %}

{% block title %}{{ report.title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'report/css/report/report_detail.css' %}">
{% endblock %}

{% block body %}
<div class="report-detail-container container">

    <!-- عنوان و اطلاعات -->
    <header class="report-header">
        <h1 class="report-title">{{ report.title }}</h1>
        <div class="report-meta">
            <span class="report-date">
                {{ report.date|jformat:"%Y/%m/%d" }}
            </span>
            {% if report.author %}
            <span class="report-author">نویسنده: {{ report.author }}</span>
            {% endif %}
        </div>
    </header>

    <!-- گالری تصاویر -->
    {% if report.images.all %}
    <section class="report-gallery">
        {% for image in report.images.all %}
        <div class="gallery-item">
            <img src="{{ image.image.url }}" alt="{{ report.title }}">
        </div>
        {% endfor %}
    </section>
    {% endif %}

    <!-- متن گزارش -->
    <article class="report-content">
        {{ report.description|linebreaks }}
    </article>

    <!-- بخش نظرات -->
    <section class="comments-section">
        <h2>نظرات</h2>

        <!-- فرم ثبت نظر -->
        <a href="{% url 'report:report_comment' report.slug %}" class="btn btn-primary">ارسال نظر</a>

        <!-- لیست نظرات -->
        <div class="comments-list">
            {% if comments %}
                {% for comment in comments %}
                    {% if comment.active %}
                        <div class="comment-card">
                            <div class="comment-header">
                                <strong>{{ comment.name }}</strong>
                                <span class="comment-date">{{ comment.created |jformat:"%Y/%m/%d" }}</span>
                            </div>
                            <p class="comment-body">{{ comment.body }}</p>
                        </div>
                    {% else %}
                        <p class="no-comments">هنوز نظری ثبت نشده است.</p>
                    {% endif %}
                {% endfor %}
            {% else %}
                <p class="no-comments">هنوز نظری ثبت نشده است.</p>
            {% endif %}
        </div>
        {% if comments.count > 3 %}
            <div class="">
                <a href="{% url 'report:report_comment_list' report.slug %}">مشاهده تمام کامنت ها</a>
            </div>
        {% endif %}
    </section>
</div>

<!-- Lightbox -->
<div id="lightbox" class="lightbox">
    <span class="close">&times;</span>
    <img class="lightbox-img" src="" alt="">
</div>

<script src="{% static 'report/js/lightbox.js' %}"></script>
{% endblock %}